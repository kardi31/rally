    <script>
        $(document).ready(function(){
           $('.rallyButtons a').click(function(){
              $('.rallyButtons a.active').removeClass('active');
              $(this).addClass('active');
              $('.mainUserBox.active').hide();
              $('.mainUserBox.active').removeClass('active');
              $('#'+$(this).attr('rel')).show();
              $('#'+$(this).attr('rel')).addClass('active');
           });
        });
        
    </script>
<!--<a href="/rally/list-rally">Powrót do listy rajdów</a>-->
<?php
     if(isset($_GET['msg'])){
        if($_GET['msg']=='joined'){
            $this->showSuccess($this->translate('You have joined the rally.'));
        }
        elseif($_GET['msg']=='signup finish'){
            $this->showError($this->translate('Sorry. Sign ups for this rally are closed.'));
        }
    }
?>

<div class="mainUserBox showRallyWrapper">
    <h4 class="boxHeader"><?php  echo $rally['name']; ?></h4>
    <div class="showRallyBox <?php if(!$rally['finished']) echo "active"?> mainUserBox" id="details">
        <?php if(strlen($rally['description'])) echo $rally['description']."<br /><br />"; ?>
       
       <?= $this->translate('Prize pool');?> : <?php echo $prizePool."$"; ?><br />
        <?= $this->translate('Signed crews');?> : <?php echo $crewCounter; ?><br />
        <?= $this->translate('Race start');?> : <?php echo $startDate->format('d/m/Y H:i'); ?><br />
        <?= $this->translate('Sign up finish');?> : <?php echo $signUpFinish->format('d/m/Y H:i'); ?><br />
        <?= $this->translate('Surface');?> : <?php
        foreach($rally['Surfaces'] as $key=>$surface):
          echo $surface['surface']." ".round($surface['percentage'])."%";  
            if($key==0)
                echo ", ";
        endforeach;
        ?>
        <br />
        <?php if(isset($isParticipant)&&$isParticipant): ?>
            <span class="label label-success"><?= $this->translate('You already participate in this rally.');?></span>
        <?php endif; ?>
        <br />
        <br />
         <?php if(isset($form)&&!$rally['finished']): ?>
        <div class="sign-up-rally">
            <h3><?= $this->translate('Sign up');?></h3>
            <form method="POST">
                <div class='formElemWrapper'>
                    <label for='driver_id' class="col-md-3 control-label" type='text'><?= $this->translate('Driver');?></label>
                    <?php echo $form->getElement('driver_id')->renderElement(); ?>
                </div>
                <div class='formElemWrapper'>
                    <label for='pilot_id' class="col-md-3 control-label"  type='text'><?= $this->translate('Pilot');?></label>
                    <?php echo $form->getElement('pilot_id')->renderElement(); ?>
                </div>     
                <div class='formElemWrapper'>
                    <label for='car_id' class="col-md-3 control-label"  type='text'><?= $this->translate('Car');?></label>
                    <?php echo $form->getElement('car_id')->renderElement(); ?>
                </div>
                <div class='formElemWrapper'>
                    <label for='risk' class="col-md-3 control-label"  type='text'><?= $this->translate('Risk');?></label>
                    <?php echo $form->getElement('risk')->renderElement(); ?>
                </div>
                <div class='formSubmitWrapper'>
                    <?php echo $form->getElement('submit')->renderElement(); ?>
                </div>

            </form>
        </div>
        <?php endif; ?>
    </div>
    <div class="showRallyBox mainUserBox" id="stages">
        <ul class="rallyStages">
            <?php foreach($rally['Stages'] as $key => $stage): ?>
            <li><?= $stage['name']." - ".$stage['length']; ?> km 
                <br /><i class="fa fa-clock-o"></i> 
                <?php 
                if($key!=0){
                    $startDate->add(new DateInterval('PT15M'));
                }
                echo $startDate->format("H:i"); 
                ?>
            <br /><br />
            </li>
            <?php endforeach; ?>
        </ul>
    </div>
    <div class="showRallyBox mainUserBox" id="crews">
        <table>
            <tr>
                <th></th>
                <th><?= $this->translate('Crew');?></th>
                <th><?= $this->translate('Car');?></th>
                <th><?= $this->translate('Team');?></th>
            </tr>
            <?php foreach($rally['Crews'] as $key => $crew): ?>
                    <tr>
                        <td>
                            <?= ($key+1)."."; ?>
                        </td>
                        <td>
                            <?php echo $crew['Driver']['last_name']." ".$crew['Driver']['first_name']; ?> - 
                            <?php echo $crew['Pilot']['last_name']." ".$crew['Pilot']['first_name']; ?>
                        </td>
                        <td>
                            <?php echo $crew['Car']['name']; ?>
                        </td>
                        <td>
                            <?php echo $crew['Team']['name']; ?>
                        </td>
                    </tr>
            <?php endforeach; ?>

            </table>
    </div>
    <div class="showRallyBox mainUserBox" id="prizes">
        <?php if($rally['big_awards']): ?>
                <img src="/images/b_letter.gif" />
                <br />
                <?= $this->translate('Number of crews');?> : <?php echo $crewCounter; ?><br />
                <h3><?= $this->translate('Prizes'); ?></h3>
                <?php 
                foreach($rallyPrizes as $key => $rallyPrize): 
                    $position = $key+1;
                    echo "Position ".$position." - ";
                    if($rallyPrize['type']=="car"):
                        $car = $rallyPrize['value'];
                        ?>
                        <img src="/media/cars/<?php echo $car['photo']; ?>" alt="<?php echo $car['name']; ?>" />
                        <?php 
                    else:
                        echo $rallyPrize['value']." premium";
                    endif;
                    ?>
                        <br />
                        <?php
                endforeach; 
            else: ?>
                <h3><?= $this->translate('Prizes');?></h3>
                <?php 
                foreach($rallyPrizes as $position => $rallyPrize): 
                    echo $this->translate('Position')." ".$position." - ";
                    echo $rallyPrize."$ <br /><br />";
                endforeach; 
            endif; ?>
    </div>
    <div class="showRallyBox rallyResultWrapper mainUserBox <?php if($rally['finished']) echo "active"?>" id="result">
        <table>
                    <?php foreach($rallyResults as $result): ?>
                        <tr>
                            <td>
                                <?php if($result['out_of_race']==0){
                                    echo $result['position'];
                                }
                                ?>
                            </td>
                            <td>
                                <?php echo $result['Crew']['Team']['name']; ?>
                            </td>
                            <td>
                                <?php echo $result['Crew']['Driver']['last_name']." ".$result['Crew']['Driver']['first_name']; ?> - 
                                <?php echo $result['Crew']['Pilot']['last_name']." ".$result['Crew']['Pilot']['first_name']; ?>
                            </td>
                            <td>
                                 <?php if($result['out_of_race']==0){
                                    echo $result['total_time'];
                                }
                                else{
                                    echo $this->translate("Accident on stage no")." ".$result['stage_out_number'];
                                }
                                ?>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                </table>
    </div>
    <div class="rallyButtons">
        <ul>
            
            <?php if($rally['finished']): ?>
                <li>
                    <a href="#" class="active" rel="result"><?= $this->translate('Results');?></a>
                </li>
            <?php endif ; ?>
            <li>
                <a class="<?php if(!$rally['finished']) echo "active"?>" rel="details" href="#"><?= $this->translate('Details'); ?></a>
            </li>
            <li>
                <a href="#" rel="stages"><?= $this->translate('Stages');?></a>
            </li>
            <li>
                <a href="#" rel="crews"><?= $this->translate('Signed crews');?></a>
            </li>
            <li>
                <a href="#" rel="prizes"><?= $this->translate('Prize pool');?></a>
            </li>
        </ul>
    </div>
</div>
